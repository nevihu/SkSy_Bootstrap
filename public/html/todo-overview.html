<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>Overview-Site</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.rawgit.com/JDMcKinstry/JavaScriptDateFormat/master/dateFormat.min.js"></script>
    <script>
        $(document).ready(function(){
            updateTableWithTasks();

            $(".change").on("click", function () {
                var desc = $("#inlineFormInput").val();
                var deadline_ = new Date($("#inlineFormInput2").val()).getTime();
                var progress_ = parseInt($("#inlineFormInput3").val());

                var inner = "        <th scope=\"row\">1</th>\n" +
                    "        <td><input class=\"form-control mb-2\" id=\"inlineFormInput\" placeholder=\"TODO\" required type=\"text\" value=\"" +  + "\"'></td>\n" +
                    "        <td><input class=\"form-control\" id=\"inlineFormInput2\" required type=\"date\"></td>\n" +
                    "        <td><input class=\"form-control\" id=\"inlineFormInput3\" placeholder=\"0\" required type=\"number\"></td>\" +
                "        <td taskid=" + id + "><button class='change'><i class=\"fas fa-pen\"></i></button><button class='delete'><i class=\"fas fa-trash\"></i></button></td>"

                replaceRowWithInputFields(id)

            })

            function replaceRowWithInputFields(id) {

            }

            function updateTableWithTasks() {
                $("tbody").empty();
                $.ajax({
                    url: "http://localhost:8080/tasks",
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        var sorted = sort(data);
                        var counter = 0;
                        var dateList = sorted.map(x => {
                            var date = dateFormat(new Date(x.deadline), 'EUROPEANSHORTWTIME').split(" ");
                            return {'date': date[0], 'time': date[1], 'name': x.name, 'progress': x.progress, 'id': x._id,
                            'count': ++counter}
                        })

                        dateList.forEach(x => {
                            $('tbody').append(wrapWithTdTags(x.id, x.count, x.name, x.date, x.progress))
                        })
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.status);
                        console.log(xhr)
                        console.log(thrownError);
                        console.log(ajaxOptions);
                    }
                })
            }

            function wrapWithTdTags(id, ...rest){
                var result = "<tr id=\"" + id + "\" >"
                rest.forEach(x => result+= "<td>" + x + "</td>")
                var buttons = "<td taskid=" + id + "><button class='change'><i class=\"fas fa-pen\"></i></button><button class='delete'><i class=\"fas fa-trash\"></i></button></td>"
                return result + buttons + "</tr>"
            }

            function sort(data){
                var sorted = data.sort((x,y) => {
                    if(x.deadline > y.deadline) return -1;
                    if(x.deadline < y.deadline) return 1;
                    else return 0;
                })
                return sorted;
            }

        })
    </script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Menu</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="todo-overview.html">Übersicht</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="todo-eingabe.html">Eingabe <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="todo-bearbeitung.html">Bearbeitung</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="todo-impressum.html">Impressum</a>
            </li>
        </ul>
    </div>
</nav>
<table class="table table-responsive w-auto">
    <thead>
    <tr>
        <th scope="col">#</th>
        <th scope="col">ToDo</th>
        <th scope="col">Deadline</th>
        <th scope="col">Stand in %</th>
        <th scope="col"></th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <th scope="row">1</th>
        <td>Übersichtsseite mit dem Bootstrap Framework anlegen</td>
        <td>19.04.2019</td>
        <td>100</td>
        <td><button><i class="fas fa-pen"></i></button><button><i class="fas fa-trash"></i></button></td>
    </tr>
    <tr>
        <th scope="row">2</th>
        <td>Bearbeitenseite mit dem Bootstrap Framework anlegen</td>
        <td>19.04.2019</td>
        <td>50</td>
        <td><button><i class="fas fa-pen"></i></button><button><i class="fas fa-trash"></i></button></td>
    </tr>
    <tr>
        <th scope="row">3</th>
        <td>Löschenseite mit dem Bootstrap Framework anlegen</td>
        <td>19.04.2019</td>
        <td>0</td>
        <td><button><i class="fas fa-pen"></i></button><button><i class="fas fa-trash"></i></button></td>
    </tr>
    </tbody>
</table>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>